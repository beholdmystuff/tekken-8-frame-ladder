<style>
body
{
    background: black;
    overflow-x: hidden;
    width: calc(100vw - 12px);
}
@font-face
{
    font-family: tekken;
    src: url(tekken_6_font_by_prinzkoks-d54nzev.ttf)
}
[frame]
{
    margin-top: 48px;
}
[frame] > [bar]
{
    width: inherit;
    height: 32px;
    font-size: 32px;
    line-height: 32px;
    background: #808080a0;
}
[frame] > [bar] > [impact]
{
    margin-left: 32px;
    display: inline-block;
    color: black;
    font-size: 32px;
    line-height: 32px;
    font-variant: small-caps;
    font-weight: 800;
}
[frame] > [bar] > [text]
{
    margin-left: 2.5vw;
    font-size: 28px;
    line-height: 28px;
    height: 28px;
    font-family: tekken;
    color: white;
    display: inline-block;
}

[frame] > [data]
{
    width: 100%;
    display: flex;
    flex-direction: column;
}
[data] > [char]
{
    margin: 15px;
    height: auto;
    width: auto;
    display: flex;
    flex-direction: row;
    align-content: flex-start;
    justify-content: flex-start;
    align-items: flex-start;
    background: #ffffff1a;
    position: relative;
}
[data] > [char] > [info]
{
    display: flex;
    width: 280px;
    flex-direction: column;
}
[data] > [char] > [info] > div:not(:first-child)
{
    position: relative;
    display: inline-block;
    scale: 1.1;
    width: 72px;
    height: 88px;
    background-image: url(portraits.webp);
}
[data] > [char] > [info] > [name]
{
    font-family: tekken;
    font-variant: small-caps;
    font-size: 32px;
    height: 32px;
    line-height: 32px;
    color: #f3f3f3;
    margin: 1vh 0 1vh 0;
    letter-spacing: 1px;
}
[char] > [moves]
{
    width: auto;
    display: flex;
    margin-top: 4vh;
    margin-left: 0.5vw;
    flex-direction: row;
    flex-wrap: wrap;
}
[char] > [frame]
{
    position: absolute;
    bottom: 25px;
    left: 85vw;
    color: #ffffff4f;
    font-family: 'tekken';
    font-size: 32px;
}
[moves] > [move]
{
    width: 25vw;
    height: 2vh;
    line-height: 2vh;
    color: white;
    margin: 20px;
}
[moves] > [move]
{
    position: relative;
    height: 100%;
    display: flex;
    flex-wrap: nowrap;
    flex-direction: column;
    background: #ffffff09;
    padding: 15px;
}
[moves] > [move] > div
{
    height: 100%;
    margin: 0 0 5px 0;
}
[moves] > [move] > [name] > [level]
{
    background-size: 100%;
    height: 1.2vh;
    width: 1.2vh;
    display: inline-block;
    margin-left: 0.5vw;
}
[moves] > [move] > [name] > [level^='l']
{
    background-image: url(yellow_arrow.svg);
}
[moves] > [move] > [name] > [level^='sl']
{
    background-image: url(red_arrow.svg);
}
[moves] > [move] > [name] > [level^='h']
{
    background-image: url(yellow_arrow.svg);
    -webkit-transform: scaleY(-1);
    transform: scaleY(-1);
}
[moves] > [move] > [name] > [level^='sh']
{
    background-image: url(red_arrow.svg);
    -webkit-transform: scaleY(-1);
    transform: scaleY(-1);
}
[moves] > [move] > [command]
{
    display: inline-block;
    background: #ffffff0a;
}

[moves] > [move] > [name]
{
    font-weight: 800;
}
[char] > [info] > [alisa] { background-position: -1px -1px; }
[char] > [info] > [asuka] { background-position: -75px -1px; }
[char] > [info] > [azucena] { background-position: -149px -1px; }
[char] > [info] > [bryan] { background-position: -223px -1px; }
[char] > [info] > [claudio] { background-position: -297px -1px; }
[char] > [info] > [eddy] { background-position: -75px -91px; }
[char] > [info] > [devil-jin] { background-position: -371px -1px; }
[char] > [info] > [dragunov] { background-position: -1px -91px; }
[char] > [info] > [feng] { background-position: -149px -91px; }
[char] > [info] > [hwoarang] { background-position: -223px -91px; }
[char] > [info] > [jack-8] { background-position: -297px -91px; }
[char] > [info] > [jin] { background-position: -371px -91px; }
[char] > [info] > [jun] { background-position: -1px -181px; }
[char] > [info] > [kazuya] { background-position: -75px -181px; }
[char] > [info] > [king] { background-position: -149px -181px; }
[char] > [info] > [kuma] { background-position: -223px -181px; }
[char] > [info] > [lars] { background-position: -297px -181px; }
[char] > [info] > [law] { background-position: -371px -181px; }
[char] > [info] > [lee] { background-position: -1px -271px; }
[char] > [info] > [leo] { background-position: -75px -271px; }
[char] > [info] > [leroy] { background-position: -149px -271px; }
[char] > [info] > [lili] { background-position: -223px -271px; }
[char] > [info] > [nina] { background-position: -297px -271px; }
[char] > [info] > [panda] { background-position: -371px -271px; }
[char] > [info] > [paul] { background-position: -1px -361px; }
[char] > [info] > [raven] { background-position: -75px -361px; }
[char] > [info] > [reina] { background-position: -149px -361px; }
[char] > [info] > [shaheen] { background-position: -223px -361px; }
[char] > [info] > [steve] { background-position: -297px -361px; }
[char] > [info] > [victor] { background-position: -371px -361px; }
[char] > [info] > [xiaoyu] { background-position: -1px -451px; }
[char] > [info] > [yoshimitsu] { background-position: -75px -451px; }
[char] > [info] > [zafina] { background-position: -149px -451px; }

[move] > [link]
{
    background: url(external-link.svg);
    background-size: 32px 32px;
    width: 32px;
    height: 32px;
    position: absolute;
    right: 16px;
    top: 16px;
    opacity: 0.35;
    transition: opacity 0.3s ease-out;
}
[move] > [link]:hover
{
    opacity: 0.75;
}

[menu]
{
    right: 0;
    top: 0;
    position: fixed;
    width: 64px;
    background: black;
    column-count: 2;
    padding: 8px;
}
[swoopitypoop]
{
    display: block;
    font-size: 22px;
    color: #ffffff77;
    transition: color 0.3s ease-out;
    cursor: pointer;
}
[swoopitypoop]:hover
{
    color: white;
}
[gon]
{
    cursor: pointer;
    right: 0;
    top: 0;
    position: fixed;
    width: 100px;
    height: 100px;
    background: url(gon.webp);
}
</style>

<body>

</body>
<script src="framedata.js"></script>
<script type="text/javascript">
// download char strings
// let ass = [];
// document.querySelectorAll("body > div > div > ul:nth-child(7) > li > a").forEach((element) => { ass.push(element.href.replace("https://tekkendocs.com/t8/", ""))});

function maek(type)
{
    return document.createElement(type ? type : 'div')
}

function gib(wat, wer)
{
    return (wer ? wer : document).querySelector(wat)
}

function tag(element, tag)
{
    element.setAttribute(tag, '')
}

function snip(element, tag)
{
    console.log(element);
    if (typeof element == 'string')
        element = gib(element)
    element.removeAttribute(tag, '')
}

let moves = {}
let sorted = {}
let grouped = {}

// console.log(rawFrameData)

function processCharacters(data)
{
    Object.keys(data).forEach(key => { oneProcess(key, data[key]) }) //creates moves{}
    sorted = Object.keys(moves).sort().reduce( (obj, key) => { obj[key] = moves[key]; return obj;}, {})
}

function oneProcess(char, data)
{
    data.framesNormal.forEach(move =>
    {
        if (move.startup.length == 0 && move.startup.charAt(0) != "i")
            return;

        let mov = move
        mov.character = char

        if (mov.command.indexOf(",") < 0 && mov.command != '')
        {
            const matches = mov.startup.match(/\d+/g)
            if (matches == null)
                return;

            if (!moves[matches[0]])
                moves[matches[0]] = []

            moves[matches[0]].push(mov)
        }
    })
}

function processFrames()
{
    Object.keys(sorted).forEach( key =>
    {
        oneFrame(key, sorted[key])
    })
}

function oneFrame(key, frame)
{
    let frameData = {}

    frame.forEach(move =>
    {
        if (!frameData[move.character])
            frameData[move.character] = []
        frameData[move.character].push(move)
    })

    grouped[key] = frameData
}

let levels = {}

function createMove(moveData)
{
    // console.log(moveData)
    let move = maek()
    tag(move, 'move')


    let name = maek()
    tag(name, 'name')
    name.textContent = moveData.name
    move.append(name)

    let level = maek()
    level.setAttribute('level', moveData.hitLevel)
    name.append(level)
    if (!levels[moveData.hitLevel])
        levels[moveData.hitLevel] = 1
    levels[moveData.hitLevel] += 1

    let command = maek()
    tag(command, 'command')
    command.textContent = moveData.command
    move.append(command)

    if (moveData.hit || moveData.block)
    {
        let hit = maek()
        tag(hit, 'hit')
        hit.textContent = (moveData.hit ? moveData.hit : '') + (moveData.block ? " / " + moveData.block : '')
        move.append(hit)
    }

    let link = maek('a')
    tag(link, 'link')
    link.setAttribute('href', 'https://wavu.wiki/t/' + moveData.character.charAt(0).toUpperCase() + moveData.character.slice(1).replaceAll('l-j', 'l_J') + '_movelist#' + moveData.wavuId.replaceAll('l J', 'l_J'))
    link.setAttribute('target', '_blank')
    move.append(link)

    if (moveData.recovery)
    {
        let recovery = maek()
        tag(recovery, 'recovery')
        move.append(recovery)
    }

    if (moveData.notes.length > 0)
    {
        let notes = maek()
        tag(notes, 'notes')

        const splat = moveData.notes.split("\n")
        splat.forEach(note =>
        {
            let noteElement = maek()
            noteElement.textContent = note.replace("* ", '')
            notes.append(noteElement)
        })

        move.append(notes)
    }

    if (moveData.counterHit.length > 0)
    {
        let counter = maek()
        tag(counter, 'counter')
        counter.textContent = moveData.counterHit
        move.append(counter)
    }
    // console.log(move);

    return move
}

function createCharacter(char, frameData, frame)
{
    let character = maek()
    character.setAttribute('char', '')

    let info = maek()
    tag(info, 'info')

    let portrait = maek()
    tag(portrait, char)


    let name = maek()
    tag(name, 'name')
    name.textContent = char

    let moves = maek()
    moves.setAttribute('moves', '')


    for (let index in frameData)
        moves.append(createMove(frameData[index]))

    let frameNumber = maek()
    tag(frameNumber, 'frame')
    frameNumber.textContent = frame

    info.append(name)
    info.append(portrait)

    character.append(info)
    character.append(moves)
    character.append(frameNumber)

    return character
}

function createFrame(frame, frameData)
{
    let frameElement = maek()
    frameElement.setAttribute('frame', '')
    frameElement.setAttribute('id', frame)

    let frameBar = maek()
    frameBar.setAttribute('bar', '')
    // frameBar.style.backgroundImage = 'url()'

    let impact = maek('div')
    impact.setAttribute('impact', '')
    impact.textContent = "Impact frame: " + frame

    let frameText = maek('div')
    frameText.setAttribute('text', '')
    frameText.textContent = frame

    let frameIcon = maek()
    frameIcon.setAttribute('icon', '')

    let frameDataElement = maek()
    frameDataElement.setAttribute('data', '')


    frameBar.append(frameText)
    frameBar.append(impact)
    frameBar.append(frameIcon)
    frameElement.append(frameBar)

    for (let char in frameData)
        frameDataElement.append(createCharacter(char, frameData[char], frame))

    frameElement.append(frameDataElement)

    document.body.append(frameElement)

}

function createGraph()
{
    for (let frame in grouped)
    {
        createFrame(frame, grouped[frame])
    }
}

function dewEet()
{
    processCharacters(rawFrameData)
    processFrames(moves)
    createGraph()
    createMenu()
}

function createMenu()
{
    let menu = maek()
    tag(menu, 'menu')
    tag(menu, 'hidden')

    let gon = maek()
    tag(gon, 'gon')
    gon.addEventListener('click', (event) =>
    {
        tag(gon, 'hidden')
        snip(menu, 'hidden')
    })

    Object.keys(grouped).forEach(key =>
    {
        let frameLink = maek()
        tag(frameLink, 'swoopitypoop')
        frameLink.href = '#' + key
        frameLink.textContent = key
        frameLink.addEventListener('click', (event) =>
            {
                snip(gon, 'hidden')
                tag(menu, 'hidden')
                window.location = event.target.href
            })
        snip(gon)

        menu.append(frameLink)
    })



    document.body.append(gon)
    document.body.append(menu)
}


dewEet()

</script>
